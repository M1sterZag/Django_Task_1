{% extends "tasks/base.html" %}
{% block content %}
  <div class="container">
    <h2 class="text-center" style="color: #003366;">Tasks</h2>
    
    <div class="row">
      {% for task in tasks %}
        <div class="col-md-4 col-sm-6 mb-4">
          <div class="card shadow-sm h-100 task-card">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">
                <a href="{% url 'tasks:task' task.id %}" style="color: #003366;">{{ task.title }}</a>
              </h5>
              <p class="card-text text-muted">Due: {{ task.end_date }}</p>

              <div class="mt-auto">
                {% if task.priority == 1 %}
                  <p class="mb-0 low-priority">Low Priority</p>
                {% elif task.priority == 2 %}
                  <p class="mb-0 medium-priority">Medium Priority</p>
                {% elif task.priority == 3 %}
                  <p class="mb-0 high-priority">High Priority</p>
                {% endif %}

                <div class="d-flex justify-content-between align-items-center mt-3">
                  <div>
                    <a href="{% url 'tasks:edit_task' task.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
                    <a href="{% url 'tasks:delete_task' task.id %}" class="btn btn-sm btn-outline-danger">Delete</a>
                  </div>
                  <label class="task-status-label">
                    <input type="checkbox" class="task-status-toggle" data-task-id="{{ task.id }}" {% if task.is_done %}checked{% endif %}>
                    <span class="custom-checkbox"></span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12 text-center">
          <p>No tasks ¯\_(ツ)_/¯</p>
        </div>
      {% endfor %}
    </div>

    <div class="d-flex justify-content-center">
      <a href="{% url 'tasks:new_task' %}" class="btn btn-success">Add a new task</a>
    </div>
  </div>

  <style>
    .low-priority {
      color: #28a745;
    }
    .medium-priority {
      color: #ffc107;
    }
    .high-priority {
      color: #dc3545;
    }

    .task-card {
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .task-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }

    h5.card-title {
      font-weight: bold;
    }

    .btn-outline-primary {
      color: #003366;
      border-color: #003366;
    }

    .btn-outline-danger {
      color: #dc3545;
      border-color: #dc3545;
    }

    .task-status-label {
      display: flex;
      align-items: center;
      position: relative;
    }

    .task-status-label input[type="checkbox"] {
      display: none;
    }

    .custom-checkbox {
      width: 20px;
      height: 20px;
      background-color: #f8f9fa;
      border: 2px solid #ced4da;
      border-radius: 50%;
      transition: background-color 0.3s ease, transform 0.2s ease;
      cursor: pointer;
    }

    .task-status-label input[type="checkbox"]:checked + .custom-checkbox {
      background-color: #28a745;
      transform: scale(1.1);
      border-color: #28a745;
    }

    .task-status-label .custom-checkbox:hover {
      border-color: #003366;
    }
  </style>

  <script>
    document.querySelectorAll('.task-status-toggle').forEach(function(checkbox) {
      checkbox.addEventListener('change', function() {
        const taskId = this.getAttribute('data-task-id');
        fetch(`/task/${taskId}/toggle_status/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({status: this.checked})
        }).then(response => {
          if (response.ok) {
            response.json().then(data => {
              if (data.is_done) {
                checkbox.setAttribute('checked', 'checked');
              } else {
                checkbox.removeAttribute('checked');
              }
            });
          }
        });
      });
    });
  </script>
{% endblock content %}
